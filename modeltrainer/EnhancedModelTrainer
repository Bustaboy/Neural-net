import argparse
from ml.trainer import train_model
from sqlalchemy.orm import Session
from core.database import get_db

def main():
    """Train a central trading model."""
    parser = argparse.ArgumentParser(description="Train Neural-net central trading model")
    parser.add_argument("--config", default="config/ml_config.yaml", help="Config file path")
    args = parser.parse_args()

    # Dependency injection for testing
    def get_db_session():
        db = next(get_db())
        try:
            yield db
        finally:
            db.close()

    with next(get_db_session()) as db:
        result = train_model(db)
        print(result["message"])

if __name__ == "__main__":
    main()
